#  Copyright (c) 2021, Manfred Moitzi
#  License: MIT License

import pytest
from ezdxf.entities import LWPolyline
from ezdxf.math import BoundingBox
from ezdxf import bbox, disassemble

@pytest.fixture
def lwpolyline():
    e = LWPolyline.new(
        dxfattribs={
            'flags': 0,
            'const_width': 30.0,
            'elevation': -6.3e-15,
            'extrusion': (0.0, 0.0, 1.0),
        }
    )
    e.set_points([
        (357249.82329605875, 4954.761989760096, 0.0, 0.0, 0.0),
        (357249.8232960929, 4754.761989654886, 0.0, 0.0, 0.0),
        (344950.02861482906, 4754.761987555597, 0.0, 0.0, 0.0),
        (346024.8919545457, 22651.791494699486, 0.0, 0.0, 0.0),
        (346394.25715062604, 22629.60743553468, 0.0, 0.0, 0.0),
        (348852.2203249989, 63554.76198535538, 0.0, 0.0, 0.0),
        (365174.7447149465, 63554.771747755294, 0.0, 0.0, 0.0),
        (365174.78259252, 63304.76188923858, 0.0, 0.0, 0.0),
        (368449.8283374733, 63304.77170360839, 0.0, 0.0, 0.0),
        (368449.82392463984, 64709.8501662623, 0.0, 0.0, 0.0),
        (435129.7781878577, 63960.083897621196, 0.0, 0.0, 0.0),
        (468384.82299152925, 63586.277203385485, 0.0, 0.0, 0.0),
        (468384.82358857745, 43474.76198938448, 0.0, 0.0, 0.0),
        (470084.85887012724, 43474.76196885179, 0.0, 0.0, 0.0),
        (470084.8356672275, 4554.722287747485, 0.0, 0.0, 0.0),
        (435999.8546998778, 4554.762387609691, 0.0, 0.0, 0.0),
        (435999.8554338699, 4954.760911995982, 0.0, 0.0, 0.0),
        (435999.85543141386, 4954.760914697981, 0.0, 0.0, 0.0),
        (435999.8554363259, 5154.760914697894, 0.0, 0.0, 0.0),
        (432499.8232970418, 5154.760952274693, 0.0, 0.0, 0.0),
        (432499.8232970418, 4954.760954976082, 0.0, 0.0, 0.0),
        (432499.83251111105, 4954.760954976082, 0.0, 0.0, 0.0),
        (432499.83251111105, 4954.760954976082, 0.0, 0.0, 0.0),
        (357249.8232960588, 4954.761846418085, 0.0, 0.0, 0.0),
    ])
    return e


@pytest.mark.xfail(reason="Error in TraceBuilder()?")
def test_lwpolyline_to_primitive(lwpolyline):
    primitive = disassemble.LwPolylinePrimitive(lwpolyline)
    bbox = BoundingBox(primitive.vertices())
    assert bbox.extmin.x > 0
    assert bbox.extmin.y > 0


if __name__ == '__main__':
    pytest.main([__file__])
